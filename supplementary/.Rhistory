library(dplyr)
library(tidyr)
library(ggplot2)
library(zoo)
source('../main_sim/fns_sim.R')
pL_geom_1M <- function(psi, l, phi, M) {
if (l == 1) {return(phi*psi/(phi*psi + psi^2*(1 - phi - (1 - phi)^M)))}
else {return(phi*(1-phi)^(l-1)*psi^2/(phi*psi + psi^2*(1 - phi - (1 - phi)^M)))}
}
get_exp_freq_2M <- function(psi, phi, M) {
density <- lapply(2:1500, pL_geom_2M, psi, phi, M) %>% unlist()
return(density)
}
sim.0.5 <- readRDS("../main_sim/res.sim.2M.1500.region.5000.ibdclust2cM.MAF.0.5.boot.keep.ends.rds")
sim.0.5.l <- lapply(sim.0.5, function(x) {return(x[[3]])}) %>% unlist()
sim.0.5.psi <- lapply(sim.0.5, function(x){return(x[[4]])}) %>% unlist()
keep <- which(sim.0.5.l <= 1500)
sim.0.5.l <- sim.0.5.l[keep]
sim.0.5.psi <- sim.0.5.psi[keep]
library(dplyr)
library(tidyr)
library(ggplot2)
library(zoo)
source('../main_sim/fns_sim.R')
pL_geom_1M <- function(psi, l, phi, M) {
if (l == 1) {return(phi*psi/(phi*psi + psi^2*(1 - phi - (1 - phi)^M)))}
else {return(phi*(1-phi)^(l-1)*psi^2/(phi*psi + psi^2*(1 - phi - (1 - phi)^M)))}
}
get_exp_freq_2M <- function(psi, phi, M) {
density <- lapply(2:1500, pL_geom_2M, psi, phi, M) %>% unlist()
return(density)
}
sim.0.5 <- readRDS("../main_sim/res.sim.2M.1500.region.5000.ibdclust2cM.MAF.0.5.boot.keep.ends.rds")
sim.0.5.l <- lapply(sim.0.5, function(x) {return(x[[3]])}) %>% unlist()
sim.0.5.psi <- lapply(sim.0.5, function(x){return(x[[4]])}) %>% unlist()
keep <- which(sim.0.5.l <= 1500)
sim.0.5.l <- sim.0.5.l[keep]
sim.0.5.psi <- sim.0.5.psi[keep]
### General outline for LD section
#1. prop. of singleton tracts not equal to estimated proportion in the main simulation
#2  truncated expected CDF is equal to truncated empirical CDF in main simulation
#3. both prop. of singleton tracts and truncated CDFs are equal under no LD
#?. empirical CDF in main simulation is equal to empirical CDF when simulating from the vcf file
# - observed tracts are detected correctly
#1 and #2
# comparing freq. of singletons
sim.est.freq.singletons.M <- lapply(sim.0.5.psi, pL_geom_1M, 1, 1/300, 1500) %>% unlist() %>% mean()
sim.obs.cnts <- as.data.frame(sim.0.5.l)
colnames(sim.obs.cnts) = "l"
sim.freq.singletons.M <- sum(sim.obs.cnts$l == 1)/nrow(sim.obs.cnts)
# comparing CDFs
sim.obs.cnts.df <- sim.obs.cnts %>% filter(l != 1) %>% group_by(l) %>% summarize(counts = n())
sim.obs.freq.df <- sim.obs.cnts.df
sim.obs.freq.df$freq <- sim.obs.freq.df$counts/sum(sim.obs.freq.df$counts)
sim.obs.freq.df$cdf.emp <- cumsum(sim.obs.freq.df$freq)
exp.freq.2M.df <- get_exp_freq_2M(1, 1/300, 1500) %>% as.data.frame()
exp.freq.2M.df$l <- 2:1500
exp.freq.2M.df$cdf.exp <- cumsum(exp.freq.2M.df$.)
sim.freq.df <- left_join(exp.freq.2M.df, sim.obs.freq.df, by = "l") %>% select(l, cdf.exp, cdf.emp) %>% gather(2:3, key = "exp/emp", value = "cdf")
sim.freq.df$`exp/emp` <- forcats::fct_relevel(sim.freq.df$`exp/emp`, "cdf.exp", "cdf.emp")
sim.freq.df$cdf <- na.locf(sim.freq.df$cdf)
p1 <- ggplot(sim.freq.df %>% filter(`exp/emp` %in% c("cdf.exp", "cdf.emp")), aes(x = l, y = cdf, color = `exp/emp`)) + geom_line(size = 1, alpha = 0.5) + theme_bw() + labs(y = "Cumulative density", x = expression("\u2113"), color = "") + theme(text = element_text(size=22), plot.title = element_text(hjust = 0)) + ylim(0, 1.01) +
scale_color_manual(
values = c("cdf.exp" = "#000000", "cdf.emp" = "#E41A1C"),
labels = c(expression(F[2]^{1500} * "(" * "\u2113" ~ "|" ~ phi == 300 * ")"), expression(paste(widehat(F)^{coalescent}, ("\u2113"))))) +
scale_x_continuous(breaks = c(2, 500, 1000, 1500))
p1
ggsave("cdf.p1.png", width = 12, height = 6)
sim.freq.singletons.M
# comparing freq. of singletons
sim.est.freq.singletons.M <- lapply(sim.0.5.psi, pL_geom_1M, 1, 1/300, 1500) %>% unlist() %>% mean()
sim.est.freq.singletons.M
#1 and #2
# comparing freq. of singletons
sim.est.freq.singletons.M <- lapply(sim.0.5.psi, pL_geom_1M, 1, 1/300, 1500) %>% unlist() %>% mean()
sim.obs.cnts <- as.data.frame(sim.0.5.l)
colnames(sim.obs.cnts) = "l"
sim.freq.singletons.M <- sum(sim.obs.cnts$l == 1)/nrow(sim.obs.cnts)
# comparing CDFs
sim.obs.cnts.df <- sim.obs.cnts %>% filter(l != 1) %>% group_by(l) %>% summarize(counts = n())
sim.obs.freq.df <- sim.obs.cnts.df
sim.obs.freq.df$freq <- sim.obs.freq.df$counts/sum(sim.obs.freq.df$counts)
sim.obs.freq.df$cdf.emp <- cumsum(sim.obs.freq.df$freq)
exp.freq.2M.df <- get_exp_freq_2M(1, 1/300, 1500) %>% as.data.frame()
exp.freq.2M.df$l <- 2:1500
exp.freq.2M.df$cdf.exp <- cumsum(exp.freq.2M.df$.)
sim.freq.df <- left_join(exp.freq.2M.df, sim.obs.freq.df, by = "l") %>% select(l, cdf.exp, cdf.emp) %>% gather(2:3, key = "exp/emp", value = "cdf")
sim.freq.df$`exp/emp` <- forcats::fct_relevel(sim.freq.df$`exp/emp`, "cdf.exp", "cdf.emp")
sim.freq.df$cdf <- na.locf(sim.freq.df$cdf)
p1 <- ggplot(sim.freq.df %>% filter(`exp/emp` %in% c("cdf.exp", "cdf.emp")), aes(x = l, y = cdf, color = `exp/emp`)) + geom_line(size = 1, alpha = 0.5) + theme_bw() + labs(y = "Cumulative density", x = expression("\u2113"), color = "") + theme(text = element_text(size=22), plot.title = element_text(hjust = 0)) + ylim(0, 1.01) +
scale_color_manual(
values = c("cdf.exp" = "#000000", "cdf.emp" = "#E41A1C"),
labels = c(expression(F[2]^{1500} * "(" * "\u2113" ~ "|" ~ phi == 300 * ")"), expression(paste(widehat(F)^{coalescent}, ("\u2113"))))) +
scale_x_continuous(breaks = c(2, 500, 1000, 1500))
p1
ggsave("cdf.p1.png", width = 12, height = 6)
