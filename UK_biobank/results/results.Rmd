---
title: "results"
output: html_document
date: "2025-04-22"
---

```{r setup, include=FALSE}
res_null <- read.csv("res_null.csv")
res_sum <- read.csv("res_sum.csv")
res_mixture <- read.csv("res_mixture.csv")

# ######### bootstrap #########  
# List all files starting with "bootstrap" and ending with a seed number
file_list <- list.files(pattern = "^bootstrap.*seed[0-9]+.*\\.csv$", full.names = TRUE)

# Load CSVs, remove the first column, and attach seed number
res_list <- lapply(file_list, function(file) {
  # Read CSV and drop first column
  df <- read.csv(file)

  # Extract seed number using regex
  seed <- sub(".*seed([0-9]+).*\\.csv$", "\\1", basename(file))

  # Add seed as a new column
  df$seed <- as.integer(seed)

  return(df)
})

res_boot <- do.call(rbind, res_list) %>%
  group_by(model, bootstrap, seed) %>%
  slice_min(NLL, with_ties = FALSE) %>%
  ungroup() %>%
  arrange(model, seed, bootstrap)
 
# Define desired quantiles
q_probs <- c(0.025, 0.975)
q_labels <- paste0("q", q_probs * 100)
vars <- c("w1", "NLL", "AIC", "mean", "phi1", "phi2")

# Compute quantiles grouped by model
quantiles_by_model <- res_boot %>%
  group_by(model) %>%
  group_split() %>%
  map_dfr(function(subdf) {
    model_val <- unique(subdf$model)

    # Compute quantiles for each variable
    q_named_vec <- map(vars, function(v) {
      q_vals <- quantile(subdf[[v]], probs = q_probs, na.rm = TRUE)
      setNames(q_vals, paste0(v, "_q", q_probs * 100))
    }) %>%
      flatten_dbl()

    tibble(model = model_val, !!!as.list(q_named_vec))
  })

res_df <- inner_join(res_df, quantiles_df)
```

```{r}
min(res_mixture$NLL)
```

